{
    "contents" : "#' Create variables based on species range field\n#' \n#' @author Bruno Vilela\n#' \n#' @description Create a variable based on other species values that cooccur in the geographic range.\n#'\n#' @usage lets.field(x, y, z, weigth=TRUE)\n#' \n#' @param x A PresenceAbsence object.\n#' @param y Species atribute to be maped \n#' @param z Species names in the same order of the atributes.\n#' @param weigth If TRUE the value is weighted by species range cover, \n#' if FASLSE the value is the mean of all species that cooccur with the\n#'  species target.\n#' \n#' @return Return a matrix with species x values.\n#' \n#' @seealso lets.presab\n#' \n#' @export\n\n\nlets.field <- function(x, y, z, weigth=T){\n  \n if(is.factor(y)){\n  y <- as.numeric(levels(y))[y]\n }\n\n p <- x$P[, -(1:2)]\n p2 <- p\n\n\n for(i in 1:ncol(p2)){\n  pos <- which(z==x$S[i])\n  if(length(pos)>0){\n    p2[, i] <- p2[, i]*y[pos]\n    pos2 <- which(p2[, i]==0)\n    p2[pos2, i] <- NA\n  }else{\n    p2[, i] <- NA\n  }  \n }\n\n media <- numeric(ncol(p))\n\n \n cat(\"This action may take some time...\\nWe will take the liberty to open a counting window so you can follow the progress...\")\n \n x11(2, 2, pointsize = 12)\n par(mar=c(0, 0, 0, 0)) \n n <- length(media)\n \n for(i in 1:n){\n   \n   plot.new()\n   text(0.5, 0.5, paste(paste(\"Total:\", n, \"\\n\",\"Runs to go: \", (n-i))))\n   \n  pos3 <- p[, i]==1\n  p3 <- p[pos3, -i]\n  p4 <- p2[pos3, -i]\n  mult <- p3*p4\n  if(weigth==T){\n   media[i] <- mean(mult, na.rm=T)\n  }\n  if(weigth==F){\n  mult <- matrix(mult, ncol=(ncol(p)-1)) \n  me <- colMeans(mult, na.rm=T)\n  media[i] <- mean(me, na.rm=T)\n  }\n }\n\n resultado <- cbind(x$S, media)\n colnames(resultado) <- c(\"Species\", \"Value\")\n resultado <- as.data.frame(resultado)\n resultado[, 2] <- as.numeric(levels(resultado[, 2]))[resultado[, 2]]\n return(resultado)\n}",
    "created" : 1394844473497.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3457797145",
    "id" : "3192AFB6",
    "lastKnownWriteTime" : 1394845719,
    "path" : "C:/Users/Bruno/SkyDrive/letsR/letsR/R/field.R",
    "project_path" : "R/field.R",
    "properties" : {
        "tempName" : "Untitled2"
    },
    "source_on_save" : false,
    "type" : "r_source"
}