{
    "contents" : "#' Download habitat information from IUCN\n#' \n#' @author Bruno Vilela\n#' \n#' @description Get species habitat information from IUCN website for one or more species.\n#' \n#' @usage lets.iucn.ha(input)\n#' \n#' @param input character vector with one or more species names,\n#' or an object of the PresenceAbsence class.\n#' \n#' @return A data frame with the species names in the rows and the habitats in the columns,\n#' the number 1 indicates the use of the habitat while the 0 indicates that the species do \n#' not use the habitat.\n#' \n#' @details Depending on your internet conection and the number of species, the function \n#' may take some time. So, we open a count window where you can follow the progress.\n#' Note that the internet must be turned on during all the process. \n#' \n#' @import XML\n#' \n#' @seealso lets.iucn\n#' \n#' \n#' @export\n\nlets.iucn.ha <- function(input){\n  #keep species name\n  \n  if(class(input)==\"PresenceAbsence\"){\n    input <- input$S\n  }\n  \n  \n  sps <- input \n  \n  #enpty matrix\n  habitat <- matrix(0, nrow=length(input), ncol=19) \n  \n  #Habitat names (and the name \"species\" that will be used in the matrix columns names)\n  names <- c(\"Species\", \"Forest\", \"Savanna\", \"Shrubland\", \"Grassland\", \n             \"Wetlands\", \"Rocky areas\", \"Caves and Subterranean Habitats\", \n             \"Desert\", \"Marine Neritic\", \"Marine Oceanic\", \"Marine Deep Ocean Floor\", \n             \"Marine Intertidal\", \"Marine Coastal/Supratidal\", \"Artificial/Terrestrial\", \n             \"Artificial/Aquatic\", \"Introduced Vegetation\", \"Other\", \"Unknown\")\n  \n  #Adding the column names\n  colnames(habitat) <- names\n  \n  n <- length(input)\n  cat(\"This action may take some time...\\nWe will take the liberty to open a counting window so you can follow the progress...\")\n  \n  x11(2, 2, pointsize=12)\n  par(mar=c(0, 0, 0, 0))  \n  \n  for(i in 1:n){\n    \n    plot.new()\n    text(0.5, 0.5, paste(paste(\"Total:\", n, \"\\n\", \"Runs to go: \", (n-i))))      \n    \n    #Taking the Website code from the internet\n    input <- gsub(as.matrix(input), patt=\" \", replace=\"-\")\n    h <- try(htmlParse(paste(\"http://api.iucnredlist.org/go/\", input[i], sep = \"\")), silent=TRUE)\n    b <- try(xpathSApply(h, '//div', xmlValue), silent=TRUE)[1]\n    c <- as.numeric(gsub(\"\\\\D\", \"\", b))\n    h2 <- try(htmlParse(paste(\"http://www.iucnredlist.org/details/classify/\", c, \"/0\", sep = \"\")), silent=TRUE)\n    \n    #taking the specific parts that contains the habitat names\n    b2 <- try(xpathSApply(h2, '//html', xmlValue), silent=TRUE)\n    \n    #look for the habitat names inside the string (if the sting contains the name, it will be marked 1)\n    for(t in 2:18){\n      if(sum(grep(names[t], b2))>0){\n        habitat[i, t] <- 1\n      }\n    }\n    \n    #If none of the habitat names have been found or also if the species have not been found in IUCN archives.\n    #it will be marked 1 in the column Unknwon\n    if(sum(habitat[i, ])==0){\n      habitat[i, 19] <- 1\n    }\n  }\n  \n  dev.off()\n  cat(\"\\nThank you for your patience!\")\n  \n  #Adding species names to the first column\n  habitat[, 1] <- sps\n  \n  #Return the matrix\n  return(as.data.frame(habitat))\n}\n",
    "created" : 1394284744350.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2284760158",
    "id" : "5943E59F",
    "lastKnownWriteTime" : 1394483785,
    "path" : "C:/Users/Bruno/SkyDrive/letsR/letsR/R/habitats.R",
    "project_path" : "R/habitats.R",
    "properties" : {
        "tempName" : "Untitled3"
    },
    "source_on_save" : false,
    "type" : "r_source"
}